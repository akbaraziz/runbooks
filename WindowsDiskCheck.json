{"status":{},"contains_secrets":false,"product_version":"3.0.0.0","spec":{"description":"","resources":{"endpoint_definition_list":[],"client_attrs":{},"credential_definition_list":[],"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Eval"},{"kind":"app_task","name":"ConsolidateReport and Mail"}],"name":"f35489b9_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Eval"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"ConsolidateReport and Mail"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_endpoint","name":"WinEP"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Eval","attrs":{"exit_status":[],"script":"$Output_var=\"<tr bgcolor='#dddddd'><td colspan=3 style='text-align:center'>\"+$env:COMPUTERNAME+\"<\/td><\/tr>\"\n$diskreport = Get-WmiObject Win32_logicaldisk\nforeach($i in $diskreport){ \n   try{\n     $freper=(($i.freespace\/1gb) \/ ($i.size\/1gb) * 100)\n     if($freper -lt 30){\n        $Output_var += \"<tr bgcolor='lightblue'><td>\"+$i.DeviceID+\"<\/td><td>$freper<\/td><td>Unhealthy(>70%)<\/td><\/tr>\"\n     }\n     else{\n        $Output_var += \"<tr><td>\"+$i.DeviceID+\"<\/td><td>$freper<\/td><td>Healthy<\/td><\/tr>\"   \n     }\n   }catch{\n     continue\n   }\n}     \n$Output_var+=\"#~~#\"\necho \"Output_var=$Output_var\"","eval_variables":["Output_var"],"eval_scope":"local","type":"","script_type":"npsscript"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[]},{"target_any_local_reference":{"kind":"app_endpoint","name":"MailEP"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ConsolidateReport and Mail","attrs":{"script":"echo \"Hi,\n\nPFA runbook report.\n\nThanks & Regards,\nNucalm-Devops\" > \/tmp\/test2.txt\n\necho \"<html><head><style>\ntable {\n  font-family: arial, sans-serif;\n  border-collapse: collapse;\n  width: 100%;\n}\n\ntd, th {\n  border: 1px solid #dddddd;\n  text-align: left;\n  padding: 8px;\n}\n<\/style><\/head>\n<body>\n<table>\n<tr bgcolor='grey' ><th>Mount<\/th><th>Used%<\/th><th>Status<\/th><\/tr>\n\" > \/tmp\/test1.html\necho \"@@{Output_var}@@\" | sed 's\/#~~#,\/\/g' | sed 's\/#~~#\/\/g'>> \/tmp\/test1.html\necho \"<\/table><\/body><\/html>\" >> \/tmp\/test1.html\n\nmail -s \"Runbook Report @@{calm_now}@@\" -a \/tmp\/test1.html @@{Mail_ID}@@  < \/tmp\/test2.txt","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"376558b0_runbook","main_task_local_reference":{"kind":"app_task","name":"f35489b9_dag"},"variable_list":[{"regex":{"should_validate":false,"value":"^.*$"},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"Mail_ID","value":"alekh.neema@nutanix.com","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}]}},"name":"WindowsDiskCheck"},"api_version":"3.0","metadata":{"last_update_time":"1591875577271403","kind":"runbook","spec_version":6,"creation_time":"1591874493189902","name":"WindowsDiskCheck"}}